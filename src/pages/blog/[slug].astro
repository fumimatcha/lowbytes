---
import Base from "../../layouts/Base.astro";
import SiteHeader from "../../components/SiteHeader.astro";
import type { CollectionEntry } from "astro:content";
import { getCollection, getEntry, render } from "astro:content";
// Genera todas las rutas estáticas /blog/<slug>
export async function getStaticPaths() {
  const posts = await getCollection("blog");
  return posts.map((post: CollectionEntry<"blog">) => ({ params: { slug: post.slug } }));
}


const { slug } = Astro.params;
const entry = await getEntry("blog", slug);

if (!entry) {
  Astro.response.status = 404;
}

const { Content } = entry ? await render(entry) : { Content: () => null };
const { title, description, date, tags } = entry?.data ?? {};
---

<Base title={title ?? "artículo no encontrado"} description={description ?? ""}>
  <SiteHeader />
  <main class="main-card">
    {entry ? (
      <article>
        <header class="main-card">
          <h1>{title}</h1>
          {description && <p class="lead">{description}</p>}
          <small>
          {date}
          {tags?.length ? <> · {tags.join(", ")}</> : null}</small>
          <hr />
        </header>
        <Content />
        <footer>
          <hr />
          <nav class="mt-4"><a href="/blog/">← Volver al índice del blog</a></nav>
        </footer>
      </article>
    ) : (
      <article class="prose">
        <h1>Artículo no encontrado</h1>
        <p><a href="/blog/">← Volver al índice del blog</a></p>
      </article>
    )}
  </main>
</Base>
